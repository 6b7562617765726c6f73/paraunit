services:
  ## OUTPUT PARSERS ##

  paraunit.parser.json_log_parser:
    class: Paraunit\Parser\JSONLogParser
    arguments:
      - "@paraunit.parser.json_log_fetcher"
      - "@paraunit.output_container.abnormal_terminated"
    calls:
      - [addParser, ["@paraunit.parser.pass_parser"]]
      - [addParser, ["@paraunit.parser.retry_parser"]]
      - [addParser, ["@paraunit.parser.incomplete_parser"]]
      - [addParser, ["@paraunit.parser.skipped_parser"]]
      - [addParser, ["@paraunit.parser.risky_parser"]]
      - [addParser, ["@paraunit.parser.warning_parser"]]
      - [addParser, ["@paraunit.parser.failure_parser"]]
      - [addParser, ["@paraunit.parser.error_parser"]]
    tags:
      - { name: kernel.event_listener, event: process_event.process_terminated, method: onProcessTerminated, priority: 200 }

  paraunit.parser.json_log_fetcher:
    class: Paraunit\Parser\JSONLogFetcher
    arguments:
      - "@paraunit.configuration.json_log_filename"

  paraunit.parser.pass_parser:
    class: Paraunit\Parser\AbstractParser
    arguments:
      - "@paraunit.output_container.null"
      - "."
      - "pass"

  paraunit.parser.retry_parser:
    class: Paraunit\Parser\RetryParser
    arguments:
      - %paraunit.max_retry_count%

  paraunit.parser.failure_parser:
    class: Paraunit\Parser\AbstractParser
    arguments:
      - "@paraunit.output_container.failure"
      - "F"
      - "fail"

  paraunit.parser.warning_parser:
    class: Paraunit\Parser\AbstractParser
    arguments:
      - "@paraunit.output_container.warning"
      - "W"
      - "warning"

  paraunit.parser.incomplete_parser:
    class: Paraunit\Parser\AbstractParser
    arguments:
      - "@paraunit.output_container.incomplete"
      - "I"
      - "error"
      - "Incomplete Test: "

  paraunit.parser.skipped_parser:
    class: Paraunit\Parser\AbstractParser
    arguments:
      - "@paraunit.output_container.skipped"
      - "S"
      - "error"
      - "Skipped Test: "

  paraunit.parser.risky_parser:
    class: Paraunit\Parser\AbstractParser
    arguments:
      - "@paraunit.output_container.risky"
      - "R"
      - "error"
      - "Risky Test: "

  paraunit.parser.error_parser:
    class: Paraunit\Parser\AbstractParser
    arguments:
      - "@paraunit.output_container.error"
      - "E"
      - "error"

  paraunit.parser.test_result_parser:
    class: Paraunit\Parser\TestResultsParser

 ### OUTPUT CONTAINERS ###

  paraunit.output_container.null:
    class: Paraunit\Printer\NullOutputContainer

  paraunit.output_container.abnormal_terminated:
    class: Paraunit\Printer\OutputContainer
    arguments:
      - "abnormal"
      - "abnormal terminated (fatal/segfault)"

  paraunit.output_container.error:
    class: Paraunit\Printer\OutputContainer
    arguments:
      - "error"
      - "errors"

  paraunit.output_container.failure:
    class: Paraunit\Printer\OutputContainer
    arguments:
      - "fail"
      - "failures"

  paraunit.output_container.warning:
    class: Paraunit\Printer\OutputContainer
    arguments:
      - "warning"
      - "warnings"

  paraunit.output_container.risky:
    class: Paraunit\Printer\OutputContainer
    arguments:
      - "warning"
      - "risky outcome"

  paraunit.output_container.skipped:
    class: Paraunit\Printer\OutputContainer
    arguments:
      - "skip"
      - "skipped outcome"

  paraunit.output_container.incomplete:
    class: Paraunit\Printer\OutputContainer
    arguments:
      - "incomplete"
      - "incomplete outcome"
